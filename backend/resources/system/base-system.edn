{;; Base system configuration
 ;; All environments inherit from this
 ;; Environment-specific overrides in env/{dev,test,prod}/resources/config.edn

 ;; Database configuration
 :finance-aggregator.system/db-path "./data/finance.db"

 ;; HTTP server configuration
 :finance-aggregator.system/http-port 8080

 ;; Secrets configuration (convention over configuration)
 :finance-aggregator.system/secrets-key-file "~/.config/finance-aggregator/key.txt"
 :finance-aggregator.system/secrets-file "resources/secrets.edn.age"

 ;; CORS configuration - defaults that should be overridden per environment
 :finance-aggregator.http/cors
 {:allowed-origins ["*"]
  :allowed-methods ["GET" "POST" "PUT" "DELETE" "OPTIONS"]
  :allowed-headers ["*"]
  :max-age 3600}

 ;; Plaid Link configuration - client-facing settings
 ;; Uses EDN readers to convert to actual Plaid SDK enum values
 :finance-aggregator.plaid/link-config
 {:client-name "Finance Aggregator"
  :country-codes [#plaid/country-code "CA"]
  :language "en"
  :products [#plaid/product :transactions]}

 ;; Secrets component - loads encrypted secrets at startup
 :finance-aggregator.system/secrets
 {:key-file #ig/ref :finance-aggregator.system/secrets-key-file
  :secrets-file #ig/ref :finance-aggregator.system/secrets-file}

 ;; Plaid configuration - combines secrets with link config
 :finance-aggregator.plaid/config
 {:secrets #ig/ref :finance-aggregator.system/secrets
  :link-config #ig/ref :finance-aggregator.plaid/link-config}

 ;; Database component
 :finance-aggregator.db/connection
 {:db-path #ig/ref :finance-aggregator.system/db-path}

 ;; HTTP router component
 :finance-aggregator.http/router
 {:db #ig/ref :finance-aggregator.db/connection
  :secrets #ig/ref :finance-aggregator.system/secrets
  :plaid-config #ig/ref :finance-aggregator.plaid/config
  :cors-config #ig/ref :finance-aggregator.http/cors}

 ;; HTTP server component
 :finance-aggregator.http/server
 {:port #ig/ref :finance-aggregator.system/http-port
  :router #ig/ref :finance-aggregator.http/router}}
